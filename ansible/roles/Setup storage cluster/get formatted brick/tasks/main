---
### Works
## debug:
# - name: Find Partitions who's label matches Gluster.UUID
#   debug:
#     msg: "Partition... {{fs_label_prefix + ansible_device_links.uuids[ item.key ] | join(',') }}"
#   loop: "{{ lookup('dict', ansible_device_links.labels) }}"
#   when:
#   - fs_label_prefix + ansible_device_links.uuids[ item.key ] | join(',') in item.value

#----------------------------------------------------------

- name: Make a List of Partitions formatted for Gluster
# iterate over partitions, and keeep if label matches Gluster.UUID
  set_fact:
    gluster_partition: "{{ gluster_partition + [item.key] }}"
  loop: "{{ lookup('dict', ansible_device_links.labels) }}"
  when: >
    fs_label_prefix + ansible_device_links.uuids[ item.key ] | join(',') in item.value


- name: Mount in FStab by UUID
  become: true
  ansible.posix.mount:
    path: "/mnt/gluster/{{ ansible_device_links.uuids[ item ] | join(',') }}"
    src: "UUID={{ ansible_device_links.uuids[ item ] | join(',') }}"
    fstype: "{{fstype}}"
    opts: noatime
    state: mounted
  loop: "{{ gluster_partition }}"
